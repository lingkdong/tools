(function(){function f(){this.posFrom=this.posTo=this.query=null;this.marked=[]}function g(a,b,c){return a.getSearchCursor(b,c,"string"==typeof b&&b==b.toLowerCase())}function h(a,b,c,d){a.openDialog?a.openDialog(b,d):d(prompt(c,""))}function q(a,b,c,d){if(a.openConfirm)a.openConfirm(b,d);else if(confirm(c))d[0]()}function m(a){var b=a.match(/^\/(.*)\/([a-z]*)$/);return b?RegExp(b[1],-1==b[2].indexOf("i")?"":"i"):a}function k(a,b){var c=a._searchState||(a._searchState=new f);if(c.query)return n(a,
b);h(a,r,"Search for:",function(d){a.operation(function(){if(d&&!c.query){c.query=m(d);if(2E3>a.lineCount())for(var e=g(a,c.query);e.findNext();)c.marked.push(a.markText(e.from(),e.to(),"CodeMirror-searching"));c.posFrom=c.posTo=a.getCursor();n(a,b)}})})}function n(a,b){a.operation(function(){var c=a._searchState||(a._searchState=new f),d=g(a,c.query,b?c.posFrom:c.posTo);if(!d.find(b)&&(d=g(a,c.query,b?{line:a.lineCount()-1}:{line:0,ch:0}),!d.find(b)))return;a.setSelection(d.from(),d.to());c.posFrom=
d.from();c.posTo=d.to()})}function l(a){a.operation(function(){var b=a._searchState||(a._searchState=new f);if(b.query){b.query=null;for(var c=0;c<b.marked.length;++c)b.marked[c].clear();b.marked.length=0}})}function p(a,b){h(a,s,"Replace:",function(c){c&&(c=m(c),h(a,t,"Replace with:",function(d){if(b)a.compoundChange(function(){a.operation(function(){for(var b=g(a,c);b.findNext();)if("string"!=typeof c){var e=a.getRange(b.from(),b.to()).match(c);b.replace(d.replace(/\$(\d)/,function(a,b){return e[b]}))}else b.replace(d)})});
else{l(a);var e=g(a,c,a.getCursor()),f=function(){var b=e.from(),d;if(!(d=e.findNext())&&(e=g(a,c),!(d=e.findNext())||b&&e.from().line==b.line&&e.from().ch==b.ch))return;a.setSelection(e.from(),e.to());q(a,u,"Replace?",[function(){h(d)},f])},h=function(a){e.replace("string"==typeof c?d:d.replace(/\$(\d)/,function(b,c){return a[c]}));f()};f()}}))})}var r='Search: \x3cinput type\x3d"text" style\x3d"width: 10em"/\x3e \x3cspan style\x3d"color: #888"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',
s='Replace: \x3cinput type\x3d"text" style\x3d"width: 10em"/\x3e \x3cspan style\x3d"color: #888"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',t='With: \x3cinput type\x3d"text" style\x3d"width: 10em"/\x3e',u="Replace? \x3cbutton\x3eYes\x3c/button\x3e \x3cbutton\x3eNo\x3c/button\x3e \x3cbutton\x3eStop\x3c/button\x3e";CodeMirror.commands.find=function(a){l(a);k(a)};CodeMirror.commands.findNext=k;CodeMirror.commands.findPrev=function(a){k(a,!0)};CodeMirror.commands.clearSearch=l;CodeMirror.commands.replace=
p;CodeMirror.commands.replaceAll=function(a){p(a,!0)}})();