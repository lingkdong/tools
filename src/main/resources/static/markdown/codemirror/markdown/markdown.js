(function(h){"object"==typeof exports&&"object"==typeof module?h(require("../../lib/codemirror"),require("../xml/xml"),require("../meta")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../meta"],h):h(CodeMirror)})(function(h){h.defineMode("markdown",function(y,e){function q(b,a,c){a.f=a.inline=c;return c(b,a)}function z(b){b.linkTitle=!1;b.em=!1;b.strong=!1;b.strikethrough=!1;b.quote=0;b.indentedCode=!1;r||b.f!=s||(b.f=l,b.block=m);b.trailingSpace=0;b.trailingSpaceNewLine=
!1;b.thisLineHasContent=!1;return null}function m(b,a){var c=b.sol(),d=!1!==a.list,g=a.indentedCode;a.indentedCode=!1;d&&(0<=a.indentationDiff?(4>a.indentationDiff&&(a.indentation-=a.indentationDiff),a.list=null):0<a.indentation?(a.list=null,a.listDepth=Math.floor(a.indentation/4)):(a.list=!1,a.listDepth=0));var k=null;if(4<=a.indentationDiff)return b.skipToEnd(),g||!a.prevLineHasContent?(a.indentation-=4,a.indentedCode=!0,t):null;if(b.eatSpace())return null;if((k=b.match(J))&&6>=k[1].length)return a.header=
k[1].length,e.highlightFormatting&&(a.formatting="header"),a.f=a.inline,f(a);if(!a.prevLineHasContent||a.quote||d||g||!(k=b.match(K))){if(b.eat("\x3e"))return a.quote=c?1:a.quote+1,e.highlightFormatting&&(a.formatting="quote"),b.eatSpace(),f(a);if("["===b.peek())return q(b,a,L);if(b.match(M,!0))return a.hr=!0,N;if((!a.prevLineHasContent||d)&&(b.match(A,!1)||b.match(B,!1)))return c=null,b.match(A,!0)?c="ul":(b.match(B,!0),c="ol"),a.indentation+=4,a.list=!0,a.listDepth++,e.taskLists&&b.match(C,!1)&&
(a.taskList=!0),a.f=a.inline,e.highlightFormatting&&(a.formatting=["list","list-"+c]),f(a);if(e.fencedCodeBlocks&&b.match(/^```[ \t]*([\w+#]*)/,!0))return c=RegExp.$1,h.findModeByName&&(d=h.findModeByName(c))&&(c=d.mime||d.mimes[0]),c=h.getMode(y,c),a.localMode="null"==c.name?null:c,a.localMode&&(a.localState=a.localMode.startState()),a.f=a.block=O,e.highlightFormatting&&(a.formatting="code-block"),a.code=!0,f(a)}else return a.header="\x3d"==k[0].charAt(0)?1:2,e.highlightFormatting&&(a.formatting=
"header"),a.f=a.inline,f(a);return q(b,a,a.inline)}function s(b,a){var c=n.token(b,a.htmlState);if(r&&null===a.htmlState.tagStart&&!a.htmlState.context&&a.htmlState.tokenize.isInText||a.md_inside&&-1<b.current().indexOf("\x3e"))a.f=l,a.block=m,a.htmlState=null;return c}function O(b,a){if(b.sol()&&b.match("```",!1))return a.localMode=a.localState=null,a.f=a.block=P,null;if(a.localMode)return a.localMode.token(b,a.localState);b.skipToEnd();return t}function P(b,a){b.match("```");a.block=m;a.f=l;e.highlightFormatting&&
(a.formatting="code-block");a.code=!0;var c=f(a);a.code=!1;return c}function f(b){var a=[];if(b.formatting){a.push(p);"string"===typeof b.formatting&&(b.formatting=[b.formatting]);for(var c=0;c<b.formatting.length;c++)a.push(p+"-"+b.formatting[c]),"header"===b.formatting[c]&&a.push(p+"-"+b.formatting[c]+"-"+b.header),"quote"===b.formatting[c]&&(!e.maxBlockquoteDepth||e.maxBlockquoteDepth>=b.quote?a.push(p+"-"+b.formatting[c]+"-"+b.quote):a.push("error"))}if(b.taskOpen)return a.push("meta"),a.length?
a.join(" "):null;if(b.taskClosed)return a.push("property"),a.length?a.join(" "):null;b.linkHref?a.push(u,"url"):(b.strong&&a.push(Q),b.em&&a.push(R),b.strikethrough&&a.push(S),b.linkText&&a.push(D),b.code&&a.push(t));b.header&&(a.push(E),a.push(E+"-"+b.header));b.quote&&(a.push(v),!e.maxBlockquoteDepth||e.maxBlockquoteDepth>=b.quote?a.push(v+"-"+b.quote):a.push(v+"-"+e.maxBlockquoteDepth));!1!==b.list&&((c=(b.listDepth-1)%3)?1===c?a.push(T):a.push(U):a.push(V));b.trailingSpaceNewLine?a.push("trailing-space-new-line"):
b.trailingSpace&&a.push("trailing-space-"+(b.trailingSpace%2?"a":"b"));return a.length?a.join(" "):null}function W(b,a){if(b.match(X,!0))return f(a)}function l(b,a){var c=a.text(b,a);if("undefined"!==typeof c)return c;if(a.list)return a.list=null,f(a);if(a.taskList)return"x"!==b.match(C,!0)[1]?a.taskOpen=!0:a.taskClosed=!0,e.highlightFormatting&&(a.formatting="task"),a.taskList=!1,f(a);a.taskOpen=!1;a.taskClosed=!1;if(a.header&&b.match(/^#+$/,!0))return e.highlightFormatting&&(a.formatting="header"),
f(a);var c=b.sol(),d=b.next();if("\\"===d&&(b.next(),e.highlightFormatting))return(c=f(a))?c+" formatting-escape":"formatting-escape";if(a.linkTitle){a.linkTitle=!1;var g=d;"("===d&&(g=")");g=(g+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");if(b.match(RegExp("^\\s*(?:[^"+g+"\\\\]+|\\\\\\\\|\\\\.)"+g),!0))return u}if("`"===d){c=a.formatting;e.highlightFormatting&&(a.formatting="code");d=f(a);g=b.pos;b.eatWhile("`");g=1+b.pos-g;if(a.code){if(g===F)return a.code=!1,d;a.formatting=c}else F=g,a.code=!0;
return f(a)}if(a.code)return f(a);if("!"===d&&b.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return b.match(/\[[^\]]*\]/),a.inline=a.f=G,Y;if("["===d&&b.match(/.*\](\(.*\)| ?\[.*\])/,!1))return a.linkText=!0,e.highlightFormatting&&(a.formatting="link"),f(a);if("]"===d&&a.linkText&&b.match(/\(.*\)| ?\[.*\]/,!1))return e.highlightFormatting&&(a.formatting="link"),c=f(a),a.linkText=!1,a.inline=a.f=G,c;if("\x3c"===d&&b.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1))return a.f=a.inline=H,e.highlightFormatting&&
(a.formatting="link"),c=f(a),(c?c+" ":"")+w;if("\x3c"===d&&b.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1))return a.f=a.inline=H,e.highlightFormatting&&(a.formatting="link"),c=(c=f(a))?c+" ":"",c+Z;if("\x3c"===d&&b.match(/^(!--|\w)/,!1))return c=b.string.indexOf("\x3e",b.pos),-1!=c&&(c=b.string.substring(b.start,c),/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(c)&&(a.md_inside=!0)),b.backUp(1),a.htmlState=h.startState(n),c=s,a.f=a.block=c,c(b,a);if("\x3c"===d&&b.match(/^\/\w*?>/))return a.md_inside=!1,"tag";
g=!1;if(!e.underscoresBreakWords&&"_"===d&&"_"!==b.peek()&&b.match(/(\w)/,!1)){var k=b.pos-2;0<=k&&(k=b.string.charAt(k),"_"!==k&&k.match(/(\w)/,!1)&&(g=!0))}if("*"===d||"_"===d&&!g){if(!c||" "!==b.peek()){if(a.strong===d&&b.eat(d))return e.highlightFormatting&&(a.formatting="strong"),d=f(a),a.strong=!1,d;if(!a.strong&&b.eat(d))return a.strong=d,e.highlightFormatting&&(a.formatting="strong"),f(a);if(a.em===d)return e.highlightFormatting&&(a.formatting="em"),d=f(a),a.em=!1,d;if(!a.em)return a.em=d,
e.highlightFormatting&&(a.formatting="em"),f(a)}}else if(" "===d&&(b.eat("*")||b.eat("_"))){if(" "===b.peek())return f(a);b.backUp(1)}if(e.strikethrough)if("~"===d&&b.eatWhile(d)){if(a.strikethrough)return e.highlightFormatting&&(a.formatting="strikethrough"),d=f(a),a.strikethrough=!1,d;if(b.match(/^[^\s]/,!1))return a.strikethrough=!0,e.highlightFormatting&&(a.formatting="strikethrough"),f(a)}else if(" "===d&&b.match(/^~~/,!0)){if(" "===b.peek())return f(a);b.backUp(2)}" "===d&&(b.match(/ +$/,!1)?
a.trailingSpace++:a.trailingSpace&&(a.trailingSpaceNewLine=!0));return f(a)}function H(b,a){if("\x3e"===b.next()){a.f=a.inline=l;e.highlightFormatting&&(a.formatting="link");var c=f(a);return(c?c+" ":"")+w}b.match(/^[^>]+/,!0);return w}function G(b,a){if(b.eatSpace())return null;var c=b.next();return"("===c||"["===c?(a.f=a.inline=$("("===c?")":"]"),e.highlightFormatting&&(a.formatting="link-string"),a.linkHref=!0,f(a)):"error"}function $(b){return function(a,c){if(a.next()===b){c.f=c.inline=l;e.highlightFormatting&&
(c.formatting="link-string");var d=f(c);c.linkHref=!1;return d}a.match(aa(b),!0)&&a.backUp(1);c.linkHref=!0;return f(c)}}function L(b,a){return b.match(/^[^\]]*\]:/,!1)?(a.f=ba,b.next(),e.highlightFormatting&&(a.formatting="link"),a.linkText=!0,f(a)):q(b,a,l)}function ba(b,a){if(b.match(/^\]:/,!0)){a.f=a.inline=ca;e.highlightFormatting&&(a.formatting="link");var c=f(a);a.linkText=!1;return c}b.match(/^[^\]]+/,!0);return D}function ca(b,a){if(b.eatSpace())return null;b.match(/^[^\s]+/,!0);void 0===
b.peek()?a.linkTitle=!0:b.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0);a.f=a.inline=l;return u+" url"}function aa(b){x[b]||(b=(b+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),x[b]=RegExp("^(?:[^\\\\]|\\\\.)*?("+b+")"));return x[b]}var r=h.modes.hasOwnProperty("xml"),n=h.getMode(y,r?{name:"xml",htmlMode:!0}:"text/plain");void 0===e.highlightFormatting&&(e.highlightFormatting=!1);void 0===e.maxBlockquoteDepth&&(e.maxBlockquoteDepth=0);void 0===e.underscoresBreakWords&&
(e.underscoresBreakWords=!0);void 0===e.fencedCodeBlocks&&(e.fencedCodeBlocks=!1);void 0===e.taskLists&&(e.taskLists=!1);void 0===e.strikethrough&&(e.strikethrough=!1);var F=0,E="header",t="comment",v="quote",V="variable-2",T="variable-3",U="keyword",N="hr",Y="tag",p="formatting",w="link",Z="link",D="link",u="string",R="em",Q="strong",S="strikethrough",M=/^([*\-_])(?:\s*\1){2,}\s*$/,A=/^[*\-+]\s+/,B=/^[0-9]+([.)])\s+/,C=/^\[(x| )\](?=\s)/,J=/^(#+)(?: |$)/,K=/^ *(?:\={1,}|-{1,})\s*$/,X=/^[^#!\[\]*_\\<>` "'(~]+/,
x=[],I={startState:function(){return{f:m,prevLineHasContent:!1,thisLineHasContent:!1,block:m,htmlState:null,indentation:0,inline:l,text:W,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,hr:!1,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1,strikethrough:!1}},copyState:function(b){return{f:b.f,prevLineHasContent:b.prevLineHasContent,thisLineHasContent:b.thisLineHasContent,block:b.block,htmlState:b.htmlState&&h.copyState(n,b.htmlState),indentation:b.indentation,
localMode:b.localMode,localState:b.localMode?h.copyState(b.localMode,b.localState):null,inline:b.inline,text:b.text,formatting:!1,linkTitle:b.linkTitle,em:b.em,strong:b.strong,strikethrough:b.strikethrough,header:b.header,hr:b.hr,taskList:b.taskList,list:b.list,listDepth:b.listDepth,quote:b.quote,indentedCode:b.indentedCode,trailingSpace:b.trailingSpace,trailingSpaceNewLine:b.trailingSpaceNewLine,md_inside:b.md_inside}},token:function(b,a){a.formatting=!1;if(b.sol()){var c=!!a.header||a.hr;a.header=
0;a.hr=!1;if(b.match(/^\s*$/,!0)||c)return a.prevLineHasContent=!1,z(a),c?this.token(b,a):null;a.prevLineHasContent=a.thisLineHasContent;a.thisLineHasContent=!0;a.taskList=!1;a.code=!1;a.trailingSpace=0;a.trailingSpaceNewLine=!1;a.f=a.block;var c=b.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,d=4*Math.floor((c-a.indentation)/4);4<d&&(d=4);d=a.indentation+d;a.indentationDiff=d-a.indentation;a.indentation=d;if(0<c)return null}return a.f(b,a)},innerMode:function(b){return b.block==s?{state:b.htmlState,
mode:n}:b.localState?{state:b.localState,mode:b.localMode}:{state:b,mode:I}},blankLine:z,getType:f,fold:"markdown"};return I},"xml");h.defineMIME("text/x-markdown","markdown")});